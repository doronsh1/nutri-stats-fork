name: "deploy to prd"

on: 
  workflow_dispatch:

jobs:
  build-and-deply:
    runs-on: ubuntu-latest
    
    steps:
      - name: 📥 Checkout repository
        uses: actions/checkout@v3

      - name: ⚙️ Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: 📦 Install dependencies
        run: |
          npm ci
          
      - name: 🏗️ Build project
        run: npm run build

      - name: 🧪 Debug dist contents
        run: |
          echo "Listing dist directory:"
          ls -l dist
      - name: 📤 Upload dist via WebDAV using webdav
        run: |
          USER=${{ secrets.CPANEL_USER }}
          PASS=${{ secrets.CPANEL_PASS }}
          npm install -g webdav-cli
          webdav upload dist/ https://baseecli.com:2078/ --username "$USER" --password "$PASS"
      
      # - name: 📤 Upload dist via WebDAV
      #   run: |
      #     sudo apt-get update
      #     sudo apt-get install -y cadaver
      
      #     cd dist
      
      #     # Launch cadaver with inline URL and credentials
      #     cadaver open "https://${{ secrets.CPANEL_USER }}:${{ secrets.CPANEL_PASS }}@baseecli.com:2078/nutri-stats/" <<EOF
      #     mput -r *
      #     bye
      #     EOF
       
      # - name: 📤 Upload dist via WebDAV using curl
      #   run: |
      #     sudo apt-get update
      #     sudo apt-get install -y curl
      
      #     cd dist
      
      #     for file in $(find . -type f); do
      #       echo "Uploading $file..."
      #       curl -T "$file" --user '${{ secrets.CPANEL_USER }}':'${{ secrets.CPANEL_PASS }}' \
      #         "https://baseecli.com:2078/${file}"
      #     done
          
      # - name: 📤 Upload dist via WebDAV
      #   run: |
      #     sudo apt-get update
      #     sudo apt-get install -y cadaver
      
      #     cd dist
      
      #     echo "open https://baseecli.com:2078/" > ../deploy.script
      #     echo "deploy@baseecli.com" >> ../deploy.script
      #     echo "${{ secrets.CPANEL_PASS }}" >> ../deploy.script
      #     echo "mput -r *" >> ../deploy.script
      #     echo "bye" >> ../deploy.script
      
      #     cd ..
      #     cadaver < deploy.script
                
      # - name: 📤 Upload `dist/` via WebDAV
      #   run: |
      #     sudo apt-get update
      #     sudo apt-get install -y cadaver
      
      #     cd dist
      
      #     #echo "open ${{ secrets.WEBDAV_URL }}/public_html/nutri-stats/
      #     # user ${{ secrets.WEBDAV_USERNAME }}
      #     echo "open webdavs://baseecli.com:2078/
      #     user deploy@baseecli.com
      #     ${{ secrets.CPANEL_PASS }}
      #     mput -r *
      #     bye" > ../deploy.script
      
      #     cd ..
      #    cadaver < deploy.script

    
